# trigger:
# - main

# pool:
#   vmImage: ubuntu-latest

# steps:
# - task: Maven@3
#   inputs:
#     mavenPomFile: 'pom.xml'
#     goals: 'install'
#     mavenOptions: '-Xmx3072m -Dheadless'
#     javaHomeOption: 'JDKVersion'
#     jdkVersionOption: '1.17'
#     jdkArchitectureOption: 'x64'
#     publishJUnitResults: true
#     testResultsFiles: '**/TEST-*.xml'
    
# - task: PublishTestResults@2
#   inputs:
#       testResultsFormat: 'JUnit'
#       testResultsFiles: '**/TEST-*.xml'
#       mergeTestResults: true

# - task: PublishBuildArtifacts@1
#   inputs:
#       ArtifactName: 'Extent-Reports'
#       PathToPublish: './target/Extent-Reports/'


# main
# pool:
#   vmImage: ubuntu-latest

# steps:
# - task: Maven@3
#   inputs:
#     mavenPomFile: 'pom.xml'
#     goals: 'install'
#     mavenOptions: '-Xmx3072m -Dheadless'
#     javaHomeOption: 'JDKVersion'
#     jdkVersionOption: '1.17'
#     jdkArchitectureOption: 'x64'
#     publishJUnitResults: true
#     testResultsFiles: '**/TEST-*.xml'

# - script: 'mvn test'
#   displayName: 'Run TestNG tests'
#   workingDirectory: '$(System.DefaultWorkingDirectory)'

# - task: PublishTestResults@2
#   inputs:
#       testResultsFormat: 'JUnit'
#       testResultsFiles: '**/TEST-*.xml'
#       mergeTestResults: true

# - task: PublishBuildArtifacts@1
#   inputs:
#       ArtifactName: 'Extent-Reports'
#       PathToPublish: './target/Extent-Reports/'


# # main
# pool:
#   vmImage: ubuntu-latest

# steps:

# - script: |
#     # Install Xvfb
#     sudo apt-get install xvfb

#     # Start Xvfb on display :99
#     Xvfb :99 -ac &

#     # Set the DISPLAY environment variable
#     export DISPLAY=:99

# - task: Maven@3
#   inputs:
#     mavenPomFile: 'pom.xml'
#     goals: 'install'
#     mavenOptions: '-Xmx3072m'
#     javaHomeOption: 'JDKVersion'
#     jdkVersionOption: '1.17'
#     jdkArchitectureOption: 'x64'
#     publishJUnitResults: true
#     checkStyleRunAnalysis: true
#     testResultsFiles: '**/surefire-reports/TEST-*.xml'

# - task: Maven@4
#   inputs:
#     mavenPomFile: 'pom.xml'
#     publishJUnitResults: true
#     testResultsFiles: '**/surefire-reports/TEST-*.xml'
#     javaHomeOption: 'JDKVersion'
#     jdkVersionOption: '1.17'
#     mavenVersionOption: 'Default'
#     mavenAuthenticateFeed: false
#     effectivePomSkip: false
#     sonarQubeRunAnalysis: false
#     checkStyleRunAnalysis: true

# - task: PublishTestResults@2
#   inputs:
#       testResultsFormat: 'JUnit'
#       testResultsFiles: '**/surefire-reports/TEST-*.xml'
#       mergeTestResults: true

# - task: PublishBuildArtifacts@1
#   inputs:
#       ArtifactName: 'Extent-Reports'
#       PathToPublish: './target/Extent-Reports/'

# - task: Maven@4
#   inputs:
#     mavenPomFile: 'pom.xml'
#     publishJUnitResults: true
#     testResultsFiles: '**/surefire-reports/TEST-*.xml'
#     javaHomeOption: 'JDKVersion'
#     jdkVersionOption: '1.17'
#     mavenVersionOption: 'Default'
#     mavenAuthenticateFeed: false
#     effectivePomSkip: false
#     sonarQubeRunAnalysis: false
#     checkStyleRunAnalysis: true


# main
pool:
  vmImage: windows-2022

steps:
- script: |
    # Install Xvfb
    sudo apt-get install xvfb

    # Start Xvfb on display :99
    Xvfb :99 -ac &

    # Set the DISPLAY environment variable
    export DISPLAY=:99
- task: Maven@3
  inputs:
    mavenPomFile: 'pom.xml'
    goals: 'package'
    mavenOptions: '-Xmx3072m -Dheadless'
    javaHomeOption: 'JDKVersion'
    jdkVersionOption: '1.17'
    jdkArchitectureOption: 'x64'
    publishJUnitResults: true
    testResultsFiles: $(System.DefaultWorkingDirectory)/**/test-*.xml

- script: 'mvn test'
  displayName: 'Run TestNG tests'
  workingDirectory: '$(System.DefaultWorkingDirectory)'
  
- task: PublishTestResults@2
  inputs:
      testResultsFormat: 'JUnit'
      testResultsFiles: '**/TEST-*.xml'
      mergeTestResults: true

- task: PublishBuildArtifacts@1
  inputs:
      ArtifactName: 'Extent-Reports'
      PathToPublish: './target/Extent-Reports/'

- script: 'ls -R $(System.DefaultWorkingDirectory)'
  displayName: 'List Working Directory Contents'
  continueOnError: true # Continue even if the ls command fails

- task: PublishBuildArtifacts@1
  inputs:
      ArtifactName: 'Maven-Logs'
      PathToPublish: '$(System.DefaultWorkingDirectory)'
      publishLocation: 'Container'
  condition: succeededOrFailed()

